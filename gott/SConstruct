import os

cppdef = Split(ARGUMENTS.get('def', ''))
cxx = ARGUMENTS.get('cxx', Environment()['CXX'])
cflags = Split(ARGUMENTS.get('cflags', Environment()['CXXFLAGS']))
release = int(ARGUMENTS.get('release', 1))
if release:
	debug = 0
	optimize = 'full'
	debug = -1
else:
	debug = 1
	optimize = 'none'

debug = int(ARGUMENTS.get('debug', debug))

if debug == 1:
	cppdef += ['DEBUG']
elif debug == -1:
	cppdef += ['NDEBUG']

optimize = ARGUMENTS.get('optimize', optimize)

caux = ARGUMENTS.get('aux')
cflags += Split(caux)

cflagsoverride = ARGUMENTS.get('cfoverride', 0)
if cflagsoverride:
	cflags = cflagsoverride

env = Environment(
  ENV = os.environ, # FIXME: security hole?
  CXX = cxx, 
  CCFLAGS = cflags, 
  CPPPATH=['#/..', '#/contrib/ntl'], 
  LIBPATH=Split('#/contrib/ntl #/tdl #/xany #/string #/base/plugin #/base/events #/base/config #/ui #/ui/x11 #/graphics #/notify_fs' ),
  CPPDEFINES=cppdef)

Export('env')
Export('optimize')
Export('debug')

conf = SConscript('configure/SConscript')
env = conf.Finish()

env.ParseConfig('pkg-config --libs sigc++-2.0')
env.ParseConfig('pkg-config --cflags sigc++-2.0')

#env.ParseConfig('pkg-config --libs libagg')
#env.ParseConfig('pkg-config --cflags libagg')

shrd = env.Copy()
shrd.Append(CPPDEFINES = 'BUILDING_DLL')

Export('shrd')

SConscript(dirs = [
'.', 
'base', 
#'ui', 
'graphics', 
'notify_fs',
'tools/autobuild',
'contrib/ntl']
)
